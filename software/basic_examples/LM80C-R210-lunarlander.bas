10 REM ***********************
20 REM *   LUNAR   LANDER    *
30 REM * ADAPTED BY LEONARDO *
30 REM *  MILIANI FOR LM80C  *
40 REM *  FROM A SOURCE FOR  *
50 REM *        C16/+4       *
60 REM ***********************
70 GOSUB5000:GOSUB5500
80 SREG7,&B11011000:SREG10,31:SREG13,10:SREG11,50:SREG12,0:SREG6,31
90 REM
100 LOCATE4,2:PRINT"L U N A R    L A N D E R"
110 LOCATE6,4:PRINT"BY  LEONARDO MILIANI"
112 RESTORE 12000:LOCATE0,18
114 FORI=0TO31:READA:PRINTCHR$(A);:NEXT
116 LOCATE0,19:FORI=0TO31:PRINTCHR$(255);:NEXT
120 FORI=50TO111:VPOKE6912,I:VPOKE6920,I+24:PAUSE4:NEXT
122 SREG7,255:SREG10,0:SREG13,0:SREG11,0:SREG12,0
124 VPOKE6920,223
130 GOSUB4200
135 LOCATE 0,21:PRINT"DO YOU NEED INSTRUCTIONS (Y/N)?";
140 A=INKEY(0)
145 A=INKEY(20):IFA=0THEN145
150 IFA<>89ANDA<>121THENCH=5
160 I4=I5
170 CLS
180 DEF FNO(U)=X0/ABS(V0)
190 X0=(52800+INT((RND(1)-.5)*20000))*2:X0=INT(X0/1000)*1000
200 V0=-470+INT((RND(1)-.5)*100):F=1:S=1:V0=INT(V0/100)*100
210 FL=INT(2000+RND(1)*1000)
220 GOTO940
230 GOSUB1280
231 LOCATE22,16
232 PRINTCHR$(149);:FORI=1TO8:PRINTCHR$(158);:NEXT:PRINTCHR$(150);
233 LOCATE22,17:PRINTCHR$(159);" LUNAR  ";CHR$(159);
234 LOCATE22,18:PRINTCHR$(159);" LANDER ";CHR$(159);
235 LOCATE22,19
236 PRINTCHR$(152);:FORI=1TO8:PRINTCHR$(158);:NEXT:PRINTCHR$(151);
240 GOSUB600
250 GOSUB1960
260 GOSUB 6600
270 AT=TI
280 RR=INKEY(30)
285 IFRR>=48ANDRR<=57THENR=RR-48:GOSUB770
290 IFNJ=5THENT=T+INT(RND(1)*800)
300 REM IF(TMR(0)-AT)>29THENAT=TMR(0):GOTO320
310 REM GOTO300
320 T=T+R:IFRR=66 OR RR=98THENR=20:GOSUB770
330 TH=TH+1:IFR=0THENGOSUB4100
332 IFR>0THENGOSUB4000
340 A=5.4*(1-0.2*R)
350 X=V0+0.5*A:X0=X0+X
360 IFX0>0THEN380
370 X=X-X0:F=0:X0=0
380 D=V0*V0-2*X*A
390 IFD>0THEN410
400 D=-D:S=-1
410 V0=SQR(D)*S*SGN(X)
420 S=1
430 F$=STR$(FNO(U))
440 LOCATE23,3:IFV0>0THENPRINT"-";:GOTO450
445 PRINT" ";
450 PRINTMID$(STR$(V0),2,5)
460 LOCATE24,6:X0$=LEFT$(STR$(X0),9)
465 TMP$=X0$:GOSUB560:PRINTTMP$;
470 LOCATE24,9:PRINT(FL-T);
480 LOCATE24,12:TMP$=MID$(F$,2,6):PRINTTMP$;
482 GA=160-(INT(X0/826))-8
483 IFGA<8THENGA=8:GOTO485
484 IFGA>160THENGA=160
485 VPOKE6928,GA
490 IFF=0THENGOSUB1590:GOTO1640:REMGOSUB770
500 IFX0>280000 THEN 5600
510 IFT>FLTHEN530
520 GOTO 540
530 R=0:GOSUB770:PAUSE25:GOTO330
540 FS=FL-T
550 GOTO280
560 IFASC(LEFT$(TMP$,1))=32THENTMP$=MID$(TMP$,2)
565 LX=LEN(TMP$):IF LX=7 THEN 580
570 FORI=1TO(7-LX):TMP$=TMP$+" ":NEXT
580 RETURN
587 REM
598 REM *** DRAW THE CONTROL PANEL ***
599 REM
600 RESTORE 11000
610 Y=1
620 FORI=0TO20:LOCATE 1,Y
630 FORL=0TO10:READA:PRINTCHR$(A);
640 NEXT:Y=Y+1:NEXT
650 Y=1
660 FORI=0TO12:LOCATE22,Y
670 FORL=0TO9:READA:PRINTCHR$(A);
680 NEXT:Y=Y+1:NEXT
690 VPOKE6913,120:VPOKE6912,70:VPOKE6921,128
740 RETURN
750 REM
760 REM *** ENGINE MANAGEMENT ***
765 REM
770 R1=R:IFR=20THENVPOKE8208,&HD0:GOTO792
790 VPOKE8208,&H80
792 IFR1>0THENVPOKE6920,95:GOTO800
794 VPOKE6920,223
800 Y=2:FORI=9TO1STEP-1
810 IF(I>R1)THENA$=" ":GOTO830
820 A$=CHR$(128)
830 LOCATE10,Y:PRINTA$;:LOCATE10,Y+1:PRINTA$
840 Y=Y+2:NEXT
850 IF RND(1)>.9997THEN865
860 RETURN
865 IF R>7THEN 875
870 RETURN
875 LOCATE12,10:PRINT"BLOWOUT!"
880 FORI=4000TO3700STEP-25:SOUND3,I,0:PAUSE 5:NEXT:SOUND 3,0,1:PAUSE30
890 LOCATE12,10:PRINTSPC(9);
900 PAUSE 100
920 NJ=5
930 RETURN
937 REM
938 REM *** INTRUCTIONS ***
939 REM
940 CLS
950 VOLUME0,15:VPOKE6912,223
960 IFCH=5ORCR>0ORSA>0THEN 1150
962 A$="YOU ARE ABOARD A LEM MODULE ON":GOSUB4400:PRINT
964 A$="A ROUTINE MISSION LANDING ON":GOSUB4400:PRINT
966 A$="OUR SATELLITE, THE MOON.":GOSUB4400:PRINT
968 PAUSE100:PRINT
970 A$="WHILE DESCENDING, A FAILURE":GOSUB4400:PRINT
971 A$="INTO THE NAVIGATION SYSTEM IS":GOSUB4400:PRINT
972 A$="LIKELY TO COMPROMISE EVERYTHING":GOSUB4400:PRINT
975 PAUSE100:PRINT
980 A$="TO SAVE THE LEM AND YOURSELF":GOSUB4400:PRINT
982 A$="YOU MUST TAKE OVER THE MANUAL":GOSUB4400:PRINT
983 A$="CONTROLS.":GOSUB4400:PRINT
984 PAUSE100:PRINT
985 A$="YOU CAN EITHER TRY FOR A SOFT":GOSUB4400:PRINT
986 A$="LANDING OR TRY TO REGAIN THE":GOSUB4400:PRINT
987 A$="ORBIT REACHING A HEIGHT OF":GOSUB4400:PRINT
988 A$="280000 FT.":GOSUB4400:PRINT
989 PAUSE100:PRINT
990 GOSUB4500
1000 CLS
1010 A$="THE CONTROL PANEL SHOWS SOME":GOSUB4400:PRINT
1015 A$="GAUGES TO HELP YOU LAND SAFELY:":GOSUB4400:PRINT
1020 PAUSE50:A$="> VELOCITY:  IN FT/SEC":GOSUB4400:PRINT
1030 PAUSE50:A$="> HEIGHT:    IN FEET":GOSUB4400:PRINT
1040 PAUSE50:A$="> REMAINING FUEL":GOSUB4400:PRINT
1050 PAUSE50:A$="> ETML: EST. TIME TO MOON LAND":GOSUB4400:PRINT
1060 A$="  AT CURRUNT SPEED, IN SECS.":GOSUB4400:PRINT
1070 PAUSE100:PRINT
1075 A$="A NEGATIVE VELOCITY (EG., -32)":GOSUB4400:PRINT
1080 A$="MEANS THAT YOU ARE GOING UP.":GOSUB4400:PRINT
1085 PAUSE100:PRINT
1090 A$="THE ROCKETS CONTROLS ARE THE":GOSUB4400:PRINT
1095 A$="NUMBER KEYS. HIGHER NUMBERS FOR":GOSUB4400:PRINT
1100 A$="HARDER THRUSTS.":GOSUB4400:PRINT
1110 PAUSE100:PRINT
1130 A$="THE >B< KEY WILL GIVE YOU A":GOSUB4400:PRINT
1135 A$="BOOST OF 20.":GOSUB4400:PRINT
1140 PAUSE100:PRINT
1145 GOSUB 4500
1150 CLS
1151 A$="     INITIAL   CONDITIONS      ":GOSUB4400:PRINT
1152 PAUSE100:PRINT:PRINT
1156 A$="YOU WILL START AT"+STR$(X0)+" FT.":GOSUB4400:PRINT
1160 A$="YOUR SPEED IS"+STR$(ABS(V0))+" FT/SEC.":GOSUB4400:PRINT
1170 A$="YOU HAVE"+STR$(FL)+" UNITS OF FUEL.":GOSUB4400:PRINT
1190 PAUSE100:PRINT
1191 A$="YOU MUST LAND WITH SPEED LESS":GOSUB4400:PRINT
1192 A$="THAN 15 FT/SEC.":GOSUB4400:PRINT:PRINT
1200 GOSUB4500:PRINT
1230 PRINT"OK, LET'S GO!":PAUSE50:GOTO 230
1269 REM
1270 REM  *** DRAW THE STARRY SKY ***
1271 REM
1280 CLS:FORI2=1TO21
1310 LOCATE12,I2:FORI1=1TO10
1340 A=RND(1)
1350 IFA>.2THENPRINT" ";:GOTO1380
1355 IFA>.1THENPRINT".";:GOTO1380
1360 IFA>.05THENPRINT"+";:GOTO1380
1370 PRINT"*";
1380 NEXT
1430 NEXT
1580 RETURN
1590 REM
1600 VPOKE6912,223:VPOKE6920,223:VPOKE6928,223:CLS:LOCATE0,20
1610 RESTORE12000:FORI=0TO31:READA:PRINTCHR$(A);:NEXT
1620 LOCATE0,21:FORI=0TO31:PRINTCHR$(255);:NEXTI
1630 RETURN
1632 REM
1634 REM *** LANDING ***
1636 REM
1640 LOCATE0,0:A=3:IFV0<-15THENA=1
1645 SREG7,&B11011000:SREG10,31:SREG13,12:SREG11,0:SREG12,1:SREG6,31
1647 VPOKE6913,112:VPOKE6921,120
1650 FORI=0TO128:VPOKE6912,I
1652 IFR>0THENVPOKE6920,I+25
1654 PAUSEA:NEXT
1655 SREG7,255:SREG10,0:SREG13,0:SREG11,0:SREG12,0
1660 IFR>0THENVPOKE6920,223
1665 IFV0<-15THEN1740
1670 PRINT
1674 FORI=3600TO4000STEP5:SOUND1,I,0:SOUND2,I-50,0:PAUSE2:NEXT
1676 SOUND1,0,1:SOUND2,0,1
1680 IFFS<200 THENPRINT"YOU MADE IT!!! VERY CLOSE!!!"
1690 IFFS>200ANDFS<700 THENPRINT"TALK ABOUT CLOSE ENCOUNTERS!!!"
1700 IFFS>700ANDFS<1600 THENPRINT"GREAT WORK !!"FS"FUEL LEFT!"
1710 IFFS>1600 THENPRINT"WONDERFUL!!! GREAT LANDING!!!"
1720 PRINT
1730 SA=SA+1:GOTO 1860
1740 PRINT"CRASH!!!"
1745 VPOKE8215,&H90:VPOKE6920,223
1750 CL=1:FORI=16TO20:LOCATE14,I:FORL=1TO4
1755 PRINTCHR$(187);:VREG7,CL:CL=CL+1:IFCL>15THENCL=1
1760 NEXT:NEXT:VREG7,0
1770 VPOKE6912,223:GOSUB4200
1775 FORI=16TO20:LOCATE14,I:PRINT"    ";:NEXT
1780 LOCATE0,2
1790 IF FS<1THENPRINT"YOU WERE A BIT HEAVY ON THE THROTTLE"
1800 IF FS>0AND-V0<50THENPRINT"YOU NEARLY MADE IT. TOO BAD."
1810 IF FS>0AND-V0>50AND-V0<150THENPRINT"I'M SURE YOU'LL GET BETTER!"
1820 IFFS>0AND-V0>150AND-V0<250THENPRINT"GO BACK TO ASTRONAUT SCHOOL !"
1830 IFFS>0AND-V0>250THENGOSUB2200
1850 PRINT:CR=CR+1:GOTO 1860
1860 PRINT"HIT >R< FOR REPLAY, >E< TO EXIT ";:T=0:R=0:NJ=0
1865 A=INKEY(0)
1870 A=INKEY(20):IFA=0THEN1870
1880 IF A=69ORA=101THEN2020
1890 IF A=82ORA=114THENPRINT"RESTART...":PAUSE100:GOTO150
1900 GOTO1870
1960 FORA=5TO1STEP-1
1970 LOCATE0,23
1980 PRINT"   MANUAL CONTROL IN";A;"SECONDS";:SOUND3,3800,10:PAUSE70
1990 LOCATE0,23:PRINTSPC(31);:PAUSE30:NEXT
2000 LOCATE0,23:PRINT"    MANUAL CONTROL ENGAGED     ";
2002 SOUND3,2500,40:PAUSE70
2005 LOCATE0,23:PRINTSPC(31);
2010 RETURN
2020 VPOKE6912,223:VPOKE6920,223:CLS
2030 PRINT"YOU CRASHED"CR"TIMES,"
2040 PRINT"LANDED SAFELY"SA"TIMES"
2050 IF CX>0THEN PRINT"AND WENT INTO ORBIT"CX"TIMES."
2060 IFCR+2>SATHENPRINT"YOU NEED MORE PRACTICE."
2070 IFSA>CRORSA=CRTHENPRINT"ARE YOU LEARNING TO LIKE THIS   GAME?"
2080 IFSA=1 ANDCR>3THENPRINT"DO YOU GET A KICK OUT OF CRASHING?"
2090 IFCR=<2ANDSA>CR+1THENPRINT"GOOD WORK !!!"
2100 END
2200 PRINT"THAT'S A"INT(SQR(ABS(V0)))"MEGATON LANDING!!"
2210 RETURN
4000 RS=R:IFR>10THENRS=10
4005 SREG6,20-RS:SREG7,&B11011111:POKE&H8177,10:RETURN
4100 SOUND1,RND(1)*100+3950,10:SOUND2,RND(1)*100+3850,10:RETURN
4200 SREG10,15:SREG7,&B11011111:FORI=0TO31:SREG6,I:PAUSE5:NEXT
4210 SREG10,0:SREG7,255:RETURN
4300 SOUND3,RND(1)*400+400,10:RETURN
4400 FORI=1TOLEN(A$)
4410 PRINTMID$(A$,I,1);:SOUND1,100,3:PAUSE5
4420 NEXT
4440 RETURN
4497 REM
4498 REM *** WAIT FOR A KEY AND RETURN ***
4499 REM
4500 PRINT"PRESS ANY KEY TO CONTINUE":A=INKEY(0)
4510 A=INKEY(20):IFA=0THEN4510
4520 RETURN
4996 REM
4997 REM *** SCREEN CONFIG ***
4998 REM
5000 SCREEN1:VREG7,1:VREG1,&B11000011:REM SET SPRITES TO 32X32
5010 FORI=0TO19:VPOKE8192+I,&HF0:NEXT:REM WHITE CHARS ON BLACK
5020 FORI=20TO31:VPOKE8192+I,&HE0:NEXT:REM GRAY ROCKS ON BLACK
5030 RESTORE 11500:FORI=0TO7:READA:VPOKE1024+I,A:NEXT
5040 VPOKE8208,&H80:RETURN
5497 REM
5498 REM *** SPRITES SETUP ***
5499 REM
5500 RESTORE10000:FORI=0TO31:READA:VPOKE14336+I,A:NEXT
5510 VPOKE6912,50:VPOKE6912+1,112:REM +0=Y; +1=X
5520 VPOKE6912+2,0:VPOKE6912+3,5:REM +2=NAME; +3=COLOR
5530 FORI=0TO7:READA:VPOKE14368+I,A:NEXT
5535 FORI=8TO31:VPOKE14368+I,0:NEXT
5540 VPOKE6920,75:VPOKE6921,120:VPOKE6922,4:VPOKE6923,9
5550 FORI=0TO7:READA:VPOKE14400+I,A:NEXT
5555 FORI=8TO31:VPOKE14400+I,0:NEXT
5560 VPOKE6928,223:VPOKE6929,56:VPOKE6930,8:VPOKE6931,11
5570 VPOKE6932,208:REM TO STOP THE SPRITE PROCESSING
5580 RETURN
5597 REM
5598 REM *** RETURN INTO ORBIT ***
5599 REM
5600 CLS:VPOKE6912,223:VPOKE6920,223:VPOKE6928,223
5605 LOCATE 0,3:PRINT"YOU HAVE DECIDED TO REGAIN ORBIT"
5610 PRINT"THIS MEANS YOU SOON REACH THE"
5620 PRINT"ORBITAL MODULE."
5630 TM=TI:GOSUB6600:PRINT:PRINT"IT TOOK YOU ";(TI-TM)/100;"S. TO"
5640 PRINT"RETURN INTO ORBIT.":CX=CX+1:PRINT
5650 GOTO1860
5997 REM
5998 REM *** SOUND CONFIG ***
5999 REM
6000 FORI=0TO15
6010 A=0:IFI=7THENA=255
6020 SREGI,A:NEXT
6030 RETURN
6497 REM
6498 REM SET ENGINE SOUND
6499 REM
6500 SREG7,&B11011000:SREG10,31:SREG13,10:SREG11,50:SREG12,0:SREG6,ENG
6510 RETURN
6597 REM
6598 REM *** TIME CALCULATION ***
6599 REM
6600 TL=TMR(0):IFTL<0THENTL=65536+TL
6610 TH=TMR(1):IFTH<0THENTH=65536+TH
6620 TI=(TH*65536)+TL
6630 RETURN
9997 REM
9998 REM *** GAME DATA ***
9999 REM LEM SPRITE
10000 DATA 16,23,31,31,62,60,60,30
10010 DATA 63,60,63,113,99,64,64,224
10020 DATA 2,229,250,248,124,60,60,120
10030 DATA 252,60,252,142,198,2,2,7
10040 REM FIRE SPRITE
10050 DATA 60,126,126,126,60,60,24,0
10060 REM GAUGE METER
10070 DATA 32,96,224,96,32,0,0,0
10999 REM CONTROL PANEL
11000 DATA 149,158,158,158,158,155,158,155,158,158,150
11010 DATA 159,32,32,32,32,159,32,159,57,32,159
11020 DATA 159,32,32,32,32,159,32,159,32,32,159
11030 DATA 159,49,48,48,75,159,32,159,56,32,159
11040 DATA 159,32,32,32,32,159,32,159,32,32,159
11050 DATA 159,32,32,32,32,159,32,159,55,32,159
11060 DATA 159,32,32,32,32,159,32,159,32,32,159
11070 DATA 159,32,55,53,75,159,32,159,54,32,159
11080 DATA 159,32,32,32,32,159,32,159,32,32,159
11090 DATA 159,32,32,32,32,159,32,159,53,32,159
11100 DATA 159,32,32,32,32,159,32,159,32,32,159
11110 DATA 159,32,53,48,75,159,32,159,52,32,159
11120 DATA 159,32,32,32,32,159,32,159,32,32,159
11130 DATA 159,32,32,32,32,159,32,159,51,32,159
11140 DATA 159,32,32,32,32,159,32,159,32,32,159
11150 DATA 159,32,50,53,75,159,32,159,50,32,159
11160 DATA 159,32,32,32,32,159,32,159,32,32,159
11170 DATA 159,32,32,32,32,159,32,159,49,32,159
11180 DATA 159,32,32,32,32,159,32,159,32,32,159
11190 DATA 159,32,32,32,48,159,32,159,48,128,159
11200 DATA 152,158,158,158,158,153,158,153,158,158,151
11210 DATA 149,158,158,158,158,158,158,158,158,150
11220 DATA 159,32,83,80,69,69,68,32,32,159
11230 DATA 159,32,32,32,32,32,32,32,32,159
11240 DATA 154,158,158,158,158,158,158,158,158,156
11250 DATA 159,32,72,69,73,71,72,84,32,159
11260 DATA 159,32,32,32,32,32,32,32,32,159
11270 DATA 154,158,158,158,158,158,158,158,158,156
11280 DATA 159,32,32,70,85,69,76,32,32,159
11290 DATA 159,32,32,32,32,32,32,32,32,159
11300 DATA 154,158,158,158,158,158,158,158,158,156
11310 DATA 159,32,32,69,84,77,76,32,32,159
11320 DATA 159,32,32,32,32,32,32,32,32,159
11330 DATA 152,158,158,158,158,158,158,158,158,151
11500 DATA 0,0,255,255,255,255,0,0
11999 REM LANDSCAPE
12000 DATA 162,163,164,255,255,163,162,162,32,162,163,164,164,164
12010 DATA 255,255,255,255,164,163,162,32,32,162,163,162,163,164
12020 DATA 163,163,164,164
